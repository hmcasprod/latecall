<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Supervisor Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body {
    font-family: 'Inter', sans-serif;
    margin: 0;
    background-color: #f4f6f8;
    color: #333;
}
button {
    cursor: pointer;
    border: none;
    border-radius: 5px;
    font-weight: 600;
    transition: 0.2s;
}
button:hover { opacity: 0.9; }

/* Logo header */
.header-logos {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 40px;
    background-color: #fff;
    box-shadow: 0 3px 10px rgba(0,0,0,0.05);
}
.header-logos img {
    height: 60px;
}
@media(max-width:600px){
    .header-logos { padding:10px 20px; }
    .header-logos img { height:50px; }
}

/* Login */
#loginPage {
    display:flex;
    justify-content:center;
    align-items:center;
    height:calc(100vh - 80px);
}
.login-container {
    background:#fff; padding:40px 30px; border-radius:12px;
    box-shadow:0 8px 20px rgba(0,0,0,0.1); width:100%; max-width:400px;
    text-align:center;
}
.login-container h2 { margin-bottom:25px; color:#4CAF50; font-size:28px; }
.login-container input { width:100%; padding:12px 15px; margin:10px 0; border:1px solid #ccc; border-radius:6px; font-size:16px; }
.login-container button { width:100%; padding:12px; background-color:#4CAF50; color:white; margin-top:15px; font-size:16px; }

/* Dashboard */
#dashboardPage { display:none; padding:20px 40px; }
.dashboard-card {
    background:#fff;
    border-radius:12px;
    padding:20px;
    box-shadow:0 8px 20px rgba(0,0,0,0.1);
    margin-bottom:30px;
}
.dashboard-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; }
.dashboard-header h1 { color:#4CAF50; font-size:28px; }
.dashboard-header .manager-info { display:flex; align-items:center; gap:15px; }
.dashboard-header .manager-info span { font-weight:600; }
.dashboard-header .manager-info button { background-color:#f44336; color:white; padding:6px 12px; font-size:14px; }

/* Top bar */
.top-bar { display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:10px; margin-bottom:20px; }
.top-bar label { font-weight:600; }
.top-bar select, .top-bar button, .top-bar input { padding:6px 12px; font-size:14px; }
.top-bar button { background-color:#4CAF50; color:white; }

/* Table */
.table-container { overflow-x:auto; border-radius:10px; }
table { width:100%; border-collapse:collapse; min-width:700px; }
th, td { padding:10px 12px; text-align:left; }
th { background-color:#f2f2f2; font-weight:600; }
tr:nth-child(even) { background-color:#f9f9f9; }

/* Status dropdown colors */
.status-select {
    padding:5px 8px;
    border-radius:5px;
    font-weight:600;
}
.status-pending { background-color:#FFD700; color:#000; } /* Yellow */
.status-completed { background-color:#4CAF50; color:white; } /* Green */

/* Footer */
footer { text-align:center; margin-top:40px; font-size:14px; color:#888; }

/* Responsive */
@media(max-width:900px){ #dashboardPage{padding:20px;} table{min-width:600px;} }
@media(max-width:600px){ .top-bar{flex-direction:column; align-items:flex-start; gap:10px;} }
</style>
</head>
<body>

<!-- Logo Header -->
<div class="header-logos">
    <img src="logo1.png" alt="Logo 1">
    <img src="logo2.png" alt="Logo 2">
</div>

<!-- Login Page -->
<div id="loginPage">
    <div class="login-container">
        <h2>Manager Login</h2>
        <input type="text" id="username" placeholder="Username" required>
        <input type="password" id="password" placeholder="Password" required>
        <button onclick="login()">Login</button>
        <div id="errorMessage" style="color:red; margin-top:10px;"></div>
    </div>
</div>

<!-- Dashboard Page -->
<div id="dashboardPage">
    <div class="dashboard-card">
        <div class="dashboard-header">
            <h1>Supervisor Dashboard</h1>
            <div class="manager-info">
                <span id="managerName"></span>
                <button onclick="logout()">Logout</button>
            </div>
        </div>

        <div class="top-bar">
            <div>
    <label for="hubFilter">Filter by HUB:</label>
    <select id="hubFilter" onchange="loadManagerTable()">
        <option value="">All HUBs</option>
        <option>Hub 1</option>
        <option>Hub 2</option>
        <option>Hub 3</option>
        <option>Hub 4</option>
        <option>Hub 5</option>
        <option>Hub 6</option>
        <option>Hub 7</option>
        <option>Hub 8</option>
        <option>Events</option>
        <option>SAS</option>
        <option>Retrieval</option>
        <option>Life Flight</option>
        <option>Other/s : Please Specify</option> <!-- Added this line -->
    </select>
</div>

            <div>
                <label for="dateFilter">Filter by Date:</label>
                <input type="date" id="dateFilter" onchange="loadManagerTable()">
            </div>
            <div>
                <label for="searchInput">Search (Name, Corp, Unit, Trip/Reason):</label>
                <input type="text" id="searchInput" placeholder="Search..." oninput="loadManagerTable()">
            </div>
            <button onclick="exportToExcel()">Export CSV</button>
        </div>

        <div class="table-container">
            <table id="requestsTable">
                <thead>
                    <tr>
                        <th>Date</th><th>Name</th><th>Corp</th><th>HUB</th>
                        <th>Unit</th><th>Shift</th><th>Trip Number / Reason</th>
                        <th>Time Out</th><th>Status</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</div>

<script>
// Managers
let managers = [
  { username: "jcamins", fullName: "James Camins", corpNumber: "45357", password: "HMCAS1234" },
  { username: "hkerkeni", fullName: "Habib Kerkeni", corpNumber: "11748", password: "HMCAS1234" }
];

// Sample submissions
let submissions = [
    {date: "2026-02-10T08:30", name:"John Doe", corp:"12345", hub:"Hub 1", unit:"Unit A", shift:"Morning", trip:"001 - Late due to traffic", timeout:"08:30", status:"Pending"},
    {date: "2026-02-11T13:45", name:"Jane Smith", corp:"54321", hub:"Events", unit:"Unit B", shift:"Night", trip:"Missed call", timeout:"13:45", status:"Pending"}
];

// Auto logout 5 mins
let logoutTimer;
function resetTimer(){
    clearTimeout(logoutTimer);
    logoutTimer = setTimeout(()=>{ alert("Logged out due to inactivity."); logout(); },5*60*1000);
}
document.onmousemove = resetTimer;
document.onkeydown = resetTimer;

// Login
function login(){
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    const manager = managers.find(m=>m.username===username && m.password===password);
    if(manager){
        localStorage.setItem('currentManager', JSON.stringify(manager));
        checkLogin();
    } else { document.getElementById('errorMessage').innerText="Invalid username or password!"; }
}

function logout(){
    localStorage.removeItem('currentManager');
    document.getElementById('loginPage').style.display='flex';
    document.getElementById('dashboardPage').style.display='none';
    document.getElementById('username').value = '';
    document.getElementById('password').value = '';
}

// Check login state
function checkLogin(){
    const manager = JSON.parse(localStorage.getItem('currentManager'));
    if(manager){
        document.getElementById('loginPage').style.display='none';
        document.getElementById('dashboardPage').style.display='block';
        document.getElementById('managerName').innerText = `${manager.fullName} ${manager.corpNumber}`;
        resetTimer();
        loadManagerTable();
    }
}

// Format date with time
function formatDateTime(dateString){
    const months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
    const d=new Date(dateString);
    let day=d.getDate().toString().padStart(2,'0');
    let month=months[d.getMonth()];
    let year=d.getFullYear();
    let hours=d.getHours().toString().padStart(2,'0');
    let minutes=d.getMinutes().toString().padStart(2,'0');
    return `${day}-${month}-${year} ${hours}:${minutes}`;
}

// Load table with filters & search
function loadManagerTable(){
    const tbody = document.querySelector('#requestsTable tbody');
    tbody.innerHTML='';
    const hubFilter = document.getElementById('hubFilter').value.toLowerCase();
    const dateFilter = document.getElementById('dateFilter').value;
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    const manager = JSON.parse(localStorage.getItem('currentManager'));

    submissions.filter(s=>{
        const matchHub = !hubFilter || s.hub.toLowerCase()===hubFilter;
        const matchDate = !dateFilter || s.date.split('T')[0] === dateFilter;
        const matchSearch = !searchTerm ||
            s.name.toLowerCase().includes(searchTerm) ||
            s.corp.toLowerCase().includes(searchTerm) ||
            (s.trip && s.trip.toLowerCase().includes(searchTerm)) ||
            (s.unit && s.unit.toLowerCase().includes(searchTerm));
        return matchHub && matchDate && matchSearch;
    }).forEach((s,i)=>{
        let statusClass = s.status==='Pending'?'status-pending':'status-completed';
        let disabled = s.status==='Completed' ? 'disabled' : '';
        let statusHTML = `<select class="status-select ${statusClass}" onchange="updateStatus(${i}, this)" ${disabled}>
            <option value="Pending" ${s.status==='Pending'?'selected':''}>Pending</option>
            <option value="Completed" ${s.status==='Completed'?'selected':''}>Completed</option>
        </select>`;
        if(s.status==='Completed') statusHTML += ` by ${s.processedBy||manager.fullName} (${formatDateTime(s.completedAt)})`;

        tbody.innerHTML += `<tr>
            <td>${formatDateTime(s.date)}</td>
            <td>${s.name}</td>
            <td>${s.corp}</td>
            <td>${s.hub}</td>
            <td>${s.unit}</td>
            <td>${s.shift}</td>
            <td>${s.trip}</td>
            <td>${s.timeout}</td>
            <td>${statusHTML}</td>
        </tr>`;
    });
}

// Update status
function updateStatus(index, selectElem){
    const value = selectElem.value;
    if(value==='Completed'){
        const manager = JSON.parse(localStorage.getItem('currentManager'));
        submissions[index].status = value;
        submissions[index].processedBy = manager.fullName;
        submissions[index].completedAt = new Date();
        selectElem.disabled = true;
        selectElem.className = 'status-select status-completed';
    }
    loadManagerTable();
}

// Export CSV
function exportToExcel(){
    const hubFilter = document.getElementById('hubFilter').value;
    const dateFilter = document.getElementById('dateFilter').value;
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();

    let filtered = submissions.filter(s=>{
        const matchHub = !hubFilter || s.hub===hubFilter;
        const matchDate = !dateFilter || s.date.split('T')[0] === dateFilter;
        const matchSearch = !searchTerm ||
            s.name.toLowerCase().includes(searchTerm) ||
            s.corp.toLowerCase().includes(searchTerm) ||
            (s.trip && s.trip.toLowerCase().includes(searchTerm)) ||
            (s.unit && s.unit.toLowerCase().includes(searchTerm));
        return matchHub && matchDate && matchSearch;
    });

    if(filtered.length===0){ alert("No data to export!"); return; }

    let csv="Date,Name,Corp,HUB,Unit,Shift,Trip Number / Reason,Time Out,Status,Processed By,Completed At\n";
    filtered.forEach(s=>{
        csv+=`${formatDateTime(s.date)},${s.name},${s.corp},${s.hub},${s.unit},${s.shift},${s.trip},${s.timeout},${s.status},${s.processedBy||''},${s.completedAt?s.completedAt:''}\n`;
    });
    const blob=new Blob([csv], {type:'text/csv'});
    const a=document.createElement('a');
    a.href=URL.createObjectURL(blob);
    a.download="LateCallRequests.csv";
    a.click();
}

// Init
checkLogin();
</script>

<footer>
    Â© 2026 HMCAS Support Service Production. <br>
    James Ross Camins. All rights reserved.
</footer>

</body>
</html>
